# Créer un serveur avec Node.js

Ce tutoriel vous guide à travers la création d'un serveur simple en utilisant Node.js. Le code que vous avez fourni est une bonne base pour comprendre comment cela fonctionne.

```js
const PORT = process.env.PORT || 3500;

const serveur = http.createServer((requette, reponse) => {
  console.log(`${requette.url} ${requette.method}`);
});

serveur.listen(PORT, () => {
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`);
});
```

| **Fonction/Module**   | **Description**                                                     |
| --------------------- | ------------------------------------------------------------------- |
| `require("http")`     | Importer le module HTTP de Node.js pour créer un serveur.           |
| `http.createServer()` | Créer une instance de serveur pour gérer les requêtes et réponses.  |
| `serveur.listen()`    | Démarrer le serveur et écouter les requêtes sur un port spécifique. |

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs");
const promessesFichiers = require("fs").promises; // Utilisation des promesses pour les opérations sur les fichiers

// Modules spécifiques
const journalEvenement = require("./log"); // Module pour gérer les journaux d'événements
const evenements = require("events"); // Module pour gérer les événements
const monEmetteur = new evenements.EventEmitter(); // Création d'un émetteur d'événements personnalisé

const PORT = process.env.PORT || 3500; // Définit le port du serveur (3500 par défaut)

const serveur = http.createServer((requete, reponse) => {
  console.log(`URL demandée : ${requete.url}, Méthode : ${requete.method}`);
});

// Démarrer le serveur et écouter sur le port défini
serveur.listen(PORT, () =>
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`)
);
```

```html
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bienvenue sur mon serveur Node.js</title>
  </head>
  <body>
    <h1>Bonjour !</h1>
    <p>Ceci est une page servie par Node.js.</p>
  </body>
</html>
```

| **Étape**                       | **Description**                                                                                           | **Code associé**                                                                            |
| ------------------------------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- | --- | ---------------------------- |
| 1. Vérifier l'URL de la requête | Vérifie si l'URL correspond à la route principale (`/`) ou au fichier `index.html`.                       | `if (requete.url === "/"                                                                    |     | requete === "index.html") {` |
| 2. Définir le code de statut    | Définit le code de statut HTTP à `200` pour indiquer que la requête a été traitée avec succès.            | `reponse.statusCode = 200;`                                                                 |
| 3. Définir les en-têtes         | Définit les en-têtes de réponse pour indiquer que le contenu est de type HTML.                            | `reponse.setHeader("Content-Type", "text/html");`                                           |
| 4. Lire le fichier HTML         | Utilise `systemeFichier.readFile` pour lire le contenu de `index.html` depuis le système de fichiers.     | `systemeFichier.readFile(chemin.join(__dirname, "index.html"), "utf8", (erreur, data) => {` |
| 5. Vérifier les erreurs         | Gère les éventuelles erreurs pendant la lecture du fichier et répond avec un message approprié si besoin. | _(Gestion des erreurs omise dans votre exemple, mais elle est recommandée.)_                |
| 6. Envoyer la réponse           | Envoie le contenu lu (variable `data`) comme réponse au client.                                           | `reponse.end(data);`                                                                        |
| 7. Terminer la condition        | Termine le bloc conditionnel après avoir répondu.                                                         | `}`                                                                                         |

---

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs");
const promessesFichiers = require("fs").promises; // Utilisation des promesses pour les opérations sur les fichiers

// Modules spécifiques
const journalEvenement = require("./log"); // Module pour gérer les journaux d'événements
const evenements = require("events"); // Module pour gérer les événements
const monEmetteur = new evenements.EventEmitter(); // Création d'un émetteur d'événements personnalisé

const PORT = process.env.PORT || 3500; // Définit le port du serveur (3500 par défaut)

const serveur = http.createServer((requete, reponse) => {
  console.log(`URL demandée : ${requete.url}, Méthode : ${requete.method}`);

  if (requete.url === "/" || requete === "index.html") {
    reponse.statusCode = 200;
    reponse.setHeader("Content-Type", "text/html");
    systemeFichier.readFile(
      chemin.join(__dirname, "index.html"),
      "utf8",
      (erreur, data) => {
        reponse.end(data);
      }
    );
  }
});

// Démarrer le serveur et écouter sur le port défini
serveur.listen(PORT, () =>
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`)
);
```

Cela peut vous aider à comprendre chaque étape de la gestion d'une requête dans un serveur HTTP en Node.js.

```js
import { createServer } from "http";

const serveur = createServer((requete, reponse) => {
  reponse.write("Bonjour ");
  reponse.end("Monde!");
});

serveur.listen(8000, () => {
  console.log(`serveur ecoute à la porte ${serveur.address().port}`);
});
```

### Tableau des Fonctions, Étapes et Exemples de Code

| **Étape**                              | **Fonction**                    | **Description**                                                                                            | **Exemple de code général**                                                                                                                                                                                       |
| -------------------------------------- | ------------------------------- | ---------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Création du serveur HTTP**        | `http.createServer()`           | Crée un serveur HTTP qui écoute les requêtes et répond en fonction de celles-ci.                           | `const http = require('http');<br>const serveur = http.createServer((req, res) => {<br>  // traitement<br>});`                                                                                                    |
| **2. Configuration du code de statut** | `reponse.statusCode`            | Définit le code de statut HTTP de la réponse (par exemple, 404 pour "Page non trouvée", 200 pour OK).      | `reponse.statusCode = 404;`                                                                                                                                                                                       |
| **3. Configuration des en-têtes HTTP** | `reponse.setHeader()`           | Définie les en-têtes HTTP, par exemple le type de contenu de la réponse.                                   | `reponse.setHeader('Content-Type', 'text/html');`                                                                                                                                                                 |
| **4. Terminer la réponse**             | `reponse.end()`                 | Termine la réponse en envoyant les données au client. Cela peut inclure le contenu ou un message d'erreur. | `reponse.end('Page non trouvée.');`                                                                                                                                                                               |
| **5. Lire un fichier et répondre**     | `systemeFichier.readFile()`     | Lit un fichier local (par exemple, un fichier HTML) et envoie son contenu comme réponse.                   | `systemeFichier.readFile('chemin/vers/fichier.html', 'utf8', (err, data) => {<br>  reponse.end(data);<br>});`                                                                                                     |
| **6. Écouter le serveur**              | `serveur.listen()`              | Démarre le serveur pour écouter sur un port spécifique et exécute une fonction de rappel lorsque prêt.     | `serveur.listen(3500, () => {<br>  console.log('Serveur démarré');<br>});`                                                                                                                                        |
| **7. Gestion des erreurs**             | `try-catch` ou gestion d'erreur | Capture et gère les erreurs potentielles, par exemple si un fichier n'est pas trouvé.                      | `try {<br>  systemeFichier.readFile('inexistant.html', 'utf8', (err, data) => {<br>    if (err) throw err;<br>  });<br>} catch (error) {<br>  reponse.statusCode = 500;<br>  reponse.end('Erreur interne');<br>}` |

---

```js
import { createServer } from "http";

const serveur = createServer((requette, reponse) => {
  const contenu = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple de Paragraphe Stylisé</title>
  <!-- Lien vers le CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="p-4 bg-light border rounded">
          <h1 class="text-center mb-4">Bienvenue</h1>
          <p class="lead text-justify">
            Bonjour et bienvenue sur notre site web. Ce paragraphe est un exemple de contenu en français stylisé avec 
            <strong>Bootstrap</strong>. Bootstrap facilite la mise en page et le style des éléments HTML, 
            rendant les interfaces modernes et attrayantes. Profitez de la flexibilité et des outils qu'il offre !
          </p>
        </div>
      </div>
    </div>
  </div>
  <!-- Lien vers le JS de Bootstrap (facultatif) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
`;

  reponse.writeHead(200, { "Content-Type": "text/html,charset=utf-8" });
  reponse.end(contenu);
});

serveur.listen(8000, () => {
  console.log(`Serveur est courant ${serveur.address().port}`);
});
```

### Explication des étapes :

1. **Création du serveur HTTP (`http.createServer`) :**

   - Permet de définir un serveur qui écoute les requêtes HTTP. Il prend une fonction de rappel qui traite les requêtes entrantes et renvoie les réponses appropriées.

2. **Configuration du code de statut (`reponse.statusCode`) :**

   - Chaque réponse HTTP a un code de statut. Vous pouvez utiliser cette fonction pour définir le code de statut. Par exemple, un code 200 signifie que tout s'est bien passé, tandis qu'un code 404 signifie que la page demandée est introuvable.

3. **Configuration des en-têtes HTTP (`reponse.setHeader`) :**

   - Vous pouvez définir les en-têtes HTTP pour préciser des informations sur la réponse, comme le type de contenu (`Content-Type`). Cela indique au client quel type de données il peut attendre (texte, HTML, JSON, etc.).

4. **Terminer la réponse (`reponse.end`) :**

   - Lorsque vous avez fini de préparer la réponse, vous devez utiliser `end()` pour l'envoyer au client. Vous pouvez passer des données ou un message d'erreur comme argument.

5. **Lire un fichier et répondre (`systemeFichier.readFile`) :**

   - Si vous souhaitez envoyer un fichier comme réponse (par exemple, un fichier HTML), vous pouvez utiliser `readFile` pour lire le fichier. Une fois lu, vous envoyez son contenu via la réponse.

6. **Écouter le serveur (`serveur.listen`) :**

   - Permet au serveur d'écouter les requêtes entrantes sur un port spécifique (par exemple, `3500`). Vous pouvez inclure une fonction de rappel pour confirmer que le serveur fonctionne correctement.

7. **Gestion des erreurs (`try-catch`) :**
   - Utiliser `try-catch` pour gérer les erreurs qui peuvent survenir lors de la lecture d'un fichier ou d'autres processus. Par exemple, si un fichier est introuvable, vous pouvez renvoyer une erreur 500.

---

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs");
const promessesFichiers = require("fs").promises; // Utilisation des promesses pour les opérations sur les fichiers

// Modules spécifiques
const journalEvenement = require("./log"); // Module pour gérer les journaux d'événements
const evenements = require("events"); // Module pour gérer les événements
const monEmetteur = new evenements.EventEmitter(); // Création d'un émetteur d'événements personnalisé

const PORT = process.env.PORT || 3500; // Définit le port du serveur (3500 par défaut)

// Création du serveur HTTP
const serveur = http.createServer((requete, reponse) => {
  // Affichage dans la console de l'URL demandée et de la méthode HTTP utilisée (GET, POST, etc.)
  console.log(`URL demandée : ${requete.url}, Méthode : ${requete.method}`);

  // Switch pour vérifier quelle URL est demandée
  switch (requete.url) {
    // Si la requête est pour la page d'accueil ou "index.html"
    case "/":
    case "/index.html":
      // Réponse avec un code HTTP 200 (OK) et un en-tête de type de contenu HTML
      reponse.statusCode = 200;
      reponse.setHeader("Content-Type", "text/html");

      // Lecture du fichier "index.html" et renvoi du contenu dans la réponse
      systemeFichier.readFile(
        chemin.join(__dirname, "index.html"), // Emplacement du fichier index.html
        "utf8", // Encodage du fichier
        (erreur, data) => {
          // Fonction de rappel pour traiter le fichier
          // Si une erreur survient lors de la lecture du fichier
          if (erreur) {
            // Si une erreur survient, renvoyer une erreur HTTP 500 (Erreur interne du serveur)
            reponse.statusCode = 500;
            reponse.end("Erreur interne du serveur.");
          } else {
            // Si le fichier est lu avec succès, renvoyer son contenu dans la réponse
            reponse.end(data);
          }
        }
      );
      break;

    // Si l'URL demandée n'est pas trouvée, renvoyer une erreur 404 (Page non trouvée)
    default:
      reponse.statusCode = 404;
      reponse.setHeader("Content-Type", "text/plain");
      reponse.end("Page non trouvée.");
      break;
  }
});

// Démarrer le serveur et écouter sur le port défini
serveur.listen(PORT, () =>
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`)
);
```

| **Fonction / Méthode**                    | **Rôle**                                                                                                                                                             |
| ----------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `createServer((requette, reponse) => {})` | Crée un serveur HTTP. La fonction de rappel gère chaque requête entrante (`requette`) et permet d'envoyer une réponse (`reponse`) au client.                         |
| `requette.url`                            | Permet d'accéder à l'URL de la requête entrante (par exemple, pour lire les paramètres ou le chemin demandé par le client).                                          |
| `reponse.writeHead(200, { ... })`         | Définit les en-têtes HTTP envoyés au client, notamment le code de réponse HTTP (`200` pour succès) et le type de contenu (`Content-Type`).                           |
| `reponse.end(contenu)`                    | Termine la réponse et envoie le contenu (ici, une page HTML générée dynamiquement) au client.                                                                        |
| `serveur.listen(8000, callback)`          | Lance le serveur sur le port spécifié (8000 ici). La fonction de rappel est appelée lorsque le serveur démarre correctement.                                         |
| `serveur.address().port`                  | Récupère les informations sur l'adresse et le port sur lequel le serveur est en écoute.                                                                              |
| `map()` (utilisé avec `appareils`)        | Parcourt la liste `appareils` pour générer dynamiquement une liste HTML d'appareils, avec un lien (`<a>`) contenant des paramètres dans la query string (`?id=...`). |

---

```js
import { createServer } from "http";

const serveur = createServer((requette, reponse) => {
  const contenu = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple de Paragraphe Stylisé</title>
  <!-- Lien vers le CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="p-4 bg-light border rounded">
          <h1 class="text-center mb-4">Bienvenue</h1>
          <p class="lead text-justify">
            Bonjour et bienvenue sur notre site web. Ce paragraphe est un exemple de contenu en français stylisé avec 
            <strong>Bootstrap</strong>. Bootstrap facilite la mise en page et le style des éléments HTML, 
            rendant les interfaces modernes et attrayantes. Profitez de la flexibilité et des outils qu'il offre !
          </p>

          ${creerMonAappreils}
        </div>
      </div>
    </div>
  </div>
  <!-- Lien vers le JS de Bootstrap (facultatif) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
`;

  console.log(requette.url);

  reponse.writeHead(200, { "Content-Type": "text/html,charset=utf-8" });
  reponse.end(contenu);
});

serveur.listen(8000, () => {
  console.log(`Serveur est courant ${serveur.address().port}`);
});

const genererListeArticle = ({ id, marque, nom, modele, prix }) =>
  `<li><a href= "?id=${id}">  ${marque} | ${nom} | ${modele}: ${prix} </a></li>`;

const appareils = [
  {
    id: 1,
    nom: "Guitare acoustique",
    marque: "Yamaha",
    modele: "FG800",
    prix: 200,
    categorie: "Cordes",
  },
  {
    id: 2,
    nom: "Piano numérique",
    marque: "Casio",
    modele: "PX-770",
    prix: 600,
    categorie: "Clavier",
  },
  {
    id: 3,
    nom: "Synthétiseur",
    marque: "Roland",
    modele: "Juno-DS76",
    prix: 1000,
    categorie: "Clavier",
  },
  {
    id: 4,
    nom: "Batterie électronique",
    marque: "Alesis",
    modele: "Nitro Mesh Kit",
    prix: 350,
    categorie: "Percussion",
  },
  {
    id: 5,
    nom: "Saxophone",
    marque: "Yamaha",
    modele: "YAS-280",
    prix: 1200,
    categorie: "Vent",
  },
  {
    id: 6,
    nom: "Violon",
    marque: "Stentor",
    modele: "Student II",
    prix: 150,
    categorie: "Cordes",
  },
  {
    id: 7,
    nom: "Flûte traversière",
    marque: "Gemeinhardt",
    modele: "2SP",
    prix: 300,
    categorie: "Vent",
  },
  {
    id: 8,
    nom: "Enceinte Bluetooth",
    marque: "JBL",
    modele: "Flip 5",
    prix: 100,
    categorie: "Accessoire",
  },
];

const creerMonAappreils = `
<h2> Mon Appareils </h2>
<ul> ${appareils.map(genererListeArticle).join("\n")} </ul>
`;

/**
 * Serveur est courant 8000
/?id=2
/favicon.ico
/?id=4
/favicon.ico

 */
```

L'instruction switch est utile pour gérer plusieurs cas différents dans une structure conditionnelle, mais elle peut ne pas être idéale dans certaines situations où vous devez effectuer des vérifications plus spécifiques ou complexes. Par exemple, lorsque vous devez déterminer le type de contenu à retourner en fonction de l'extension d'un fichier (comme .html, .css, .js, etc.), une approche plus flexible consiste à utiliser une variable pour gérer l'extension du fichier et ensuite déterminer le type de contenu.

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs");
const promessesFichiers = require("fs").promises; // Utilisation des promesses pour les opérations sur les fichiers

// Modules spécifiques
const journalEvenement = require("./log"); // Module pour gérer les journaux d'événements
const evenements = require("events"); // Module pour gérer les événements
const monEmetteur = new evenements.EventEmitter(); // Création d'un émetteur d'événements personnalisé

const PORT = process.env.PORT || 3500;

const serveur = http.createServer((requette, reponse) => {
  console.log(`${requette.url} ${requette.method}`);

  const extension = chemin.extname(requette.url);

  let contenuType;

  switch (extension) {
    case ".html": // Si le fichier est un fichier HTML
      contenuType = "text/html";
      break;
    case ".css": // Si le fichier est un fichier CSS
      contenuType = "text/css";
      break;
    case ".js": // Si le fichier est un fichier JavaScript
      contenuType = "application/javascript";
      break;
    case ".json": // Si le fichier est un fichier JSON
      contenuType = "application/json";
      break;
    case ".jpg": // Si le fichier est une image JPG
    case ".jpeg": // Si le fichier est une image JPEG
      contenuType = "image/jpeg";
      break;
    case ".png": // Si le fichier est une image PNG
      contenuType = "image/png";
      break;
    default:
      contenuType = "text/html";
      break;
  }

  // Construire le chemin du fichier
  const cheminFichier = chemin.join(
    __dirname,
    requette.url === "/" ? "index.html" : requette.url
  );

  // Lire le fichier et le renvoyer à l'utilisateur
  systemeFichier.readFile(cheminFichier, "utf8", (erreur, data) => {
    if (erreur) {
      reponse.statusCode = 404;
      reponse.setHeader("Content-Type", "text/plain");
      reponse.end("Page non trouvée.");
      return;
    }
    reponse.statusCode = 200;
    reponse.setHeader("Content-Type", contenuType);
    reponse.end(data);
  });
});

serveur.listen(PORT, () => {
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`);
});
```

Voici un tableau qui présente les différentes fonctions utilisées dans le code, leur objectif et leur usage :

| **Fonction**                | **Description**                                                                               | **Usage dans le code**                                                                                                                       |
| --------------------------- | --------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| `systemeFichier.readFile()` | Lit un fichier de manière asynchrone.                                                         | Utilisé pour lire le fichier demandé par l'utilisateur. Le contenu est ensuite envoyé dans la réponse HTTP.                                  |
| `chemin.join()`             | Joint plusieurs segments de chemin de fichier en un seul chemin valide.                       | Utilisé pour construire le chemin du fichier demandé, que ce soit pour `index.html` ou d'autres fichiers statiques.                          |
| `requette.url`              | Accède à l'URL demandée par le client.                                                        | Utilisé pour obtenir l'URL de la requête afin de déterminer quel fichier demander (par exemple, `index.html` ou un fichier CSS/JS).          |
| `requette.method`           | Accède à la méthode HTTP de la requête (par exemple, GET, POST).                              | Utilisé pour afficher les informations de la requête, bien que dans ce code, la méthode ne soit pas utilisée.                                |
| `chemin.extname()`          | Renvoie l'extension du fichier à partir de son chemin.                                        | Utilisé pour déterminer le type de fichier (par exemple `.html`, `.css`, `.js`, etc.) et choisir le bon type MIME.                           |
| `reponse.statusCode`        | Définit le code de statut HTTP de la réponse (par exemple, 200 pour OK, 404 pour non trouvé). | Utilisé pour envoyer un code de statut HTTP approprié dans la réponse, en fonction du résultat de la lecture du fichier.                     |
| `reponse.setHeader()`       | Définit un en-tête HTTP pour la réponse.                                                      | Utilisé pour définir le type de contenu dans l'en-tête de la réponse (par exemple, `Content-Type: text/html` ou `Content-Type: image/jpeg`). |
| `reponse.end()`             | Envoie la réponse finale au client.                                                           | Utilisé pour envoyer la réponse complète, y compris le contenu du fichier ou un message d'erreur (par exemple, "Page non trouvée.").         |
| `try/catch`                 | Bloc pour gérer les exceptions (erreurs).                                                     | Utilisé pour capturer toute erreur survenue lors de la lecture du fichier et renvoyer une erreur 404 si le fichier n'est pas trouvé.         |

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs").promises; // Utilisation des promesses pour la lecture des fichiers

// Dictionnaire des types MIME en fonction des extensions
const typesMIME = {
  ".html": "text/html",
  ".css": "text/css",
  ".js": "application/javascript",
  ".json": "application/json",
  ".jpg": "image/jpeg",
  ".jpeg": "image/jpeg",
  ".png": "image/png",
};

// Le port par défaut ou celui de l'environnement
const PORT = process.env.PORT || 3500;

const serveur = http.createServer(async (requette, reponse) => {
  console.log(`${requette.url} ${requette.method}`);

  const extension = chemin.extname(requette.url) || ".html"; // Extension du fichier demandé
  const contenuType = typesMIME[extension] || "text/html"; // Récupération du type MIME

  // Construire le chemin du fichier
  const cheminFichier = chemin.join(
    __dirname,
    requette.url === "/" ? "index.html" : requette.url
  );

  try {
    // Lire le fichier et renvoyer la réponse
    const data = await systemeFichier.readFile(cheminFichier, "utf8");
    reponse.statusCode = 200;
    reponse.setHeader("Content-Type", contenuType);
    reponse.end(data);
  } catch (erreur) {
    // En cas d'erreur, renvoyer une page 404
    reponse.statusCode = 404;
    reponse.setHeader("Content-Type", "text/plain");
    reponse.end("Page non trouvée.");
  }
});

serveur.listen(PORT, () => {
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`);
});
```

```js
const http = require("http");
const chemin = require("path");
const systemeFichier = require("fs");
const promessesFichiers = require("fs").promises; // Utilisation des promesses pour les opérations sur les fichiers

const PORT = process.env.PORT || 3500;

// Définition des types MIME
const typesMIME = {
  ".html": "text/html",
  ".css": "text/css",
  ".js": "application/javascript",
  ".json": "application/json",
  ".jpg": "image/jpeg",
  ".jpeg": "image/jpeg",
  ".png": "image/png",
};

// Fonction pour servir un fichier
async function serveFile(filePath, contentType, response) {
  try {
    // Lecture du fichier
    const data = await promessesFichiers.readFile(filePath, "utf8");

    // Utilisation de writeHead pour envoyer le statut et les en-têtes
    response.writeHead(200, { "Content-Type": contentType });

    // Envoi du fichier
    response.end(data);
  } catch (erreur) {
    // En cas d'erreur, envoie une réponse 500 (erreur interne du serveur)
    console.error("Erreur lors de la lecture du fichier:", erreur);

    // Utilisation de writeHead pour envoyer le statut d'erreur et l'en-tête
    response.writeHead(500, { "Content-Type": "text/plain" });
    response.end("Erreur interne du serveur.");
  }
}

// Serveur HTTP
const serveur = http.createServer((requete, reponse) => {
  console.log(`${requete.url} ${requete.method}`);

  const extension = chemin.extname(requete.url);
  const contenuType = typesMIME[extension] || "text/html"; // Type MIME par défaut

  // Construire le chemin du fichier
  const cheminFichier = chemin.join(
    __dirname,
    requete.url === "/" ? "index.html" : requete.url
  );

  // Appel de la fonction serveFile pour gérer la demande de fichier
  serveFile(cheminFichier, contenuType, reponse);
});

serveur.listen(PORT, () => {
  console.log(`Serveur en cours d'exécution sur le port ${PORT}`);
});
```

Voici un tableau décrivant les fonctions et usages de ces lignes de code :

| **Code**                                                 | **Fonction**                                                                                       | **Usage**                                                                                                                                     |
| -------------------------------------------------------- | -------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| `const url = new URL(requette.url, "http://localhost");` | Crée une instance d'objet URL à partir de l'URL de la requête.                                     | Permet de manipuler facilement les différentes parties de l'URL (chemin, paramètres de requête, protocole, etc.) via des méthodes de l'objet. |
| `url.searchParams.get("id");`                            | Récupère la valeur du paramètre `id` dans la chaîne de requête (query string) de l'URL.            | Permet d'accéder aux données transmises via les paramètres GET dans l'URL, telles que `?id=7`.                                                |
| `console.log(url.searchParams.get("id"));`               | Affiche dans la console la valeur du paramètre `id` extrait de l'URL.                              | Utile pour le débogage : permet de vérifier que la bonne valeur est extraite du paramètre de requête.                                         |
| `const id = url.searchParams.get("id");`                 | Stocke la valeur du paramètre `id` dans une variable pour une utilisation ultérieure dans le code. | Permet de travailler avec cette valeur pour des opérations conditionnelles ou d’affichage (par ex. recherche d’un article par ID).            |

```js
import { createServer } from "http"; // Importation du module "http" pour créer un serveur

// Création d'un serveur HTTP
const serveur = createServer((requette, reponse) => {
  // Analyse de l'URL de la requête
  const url = new URL(requette.url, "http://localhost");

  // Extraction du paramètre "id" de la chaîne de requête (query string)
  console.log(url.searchParams.get("id"));
  const id = url.searchParams.get("id");

  // Contenu HTML qui sera renvoyé comme réponse
  const contenu = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple de Paragraphe Stylisé</title>
  <!-- Lien vers le CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="p-4 bg-light border rounded">
          <h1 class="text-center mb-4">Bienvenue</h1>
          <p class="lead text-justify">
            Bonjour et bienvenue sur notre site web. Ce paragraphe est un exemple de contenu en français stylisé avec 
            <strong>Bootstrap</strong>. Bootstrap facilite la mise en page et le style des éléments HTML, 
            rendant les interfaces modernes et attrayantes. Profitez de la flexibilité et des outils qu'il offre !
          </p>

          <!-- Affichage dynamique du contenu en fonction de l'ID dans la query string -->
          ${id ? obtenirContentu(id) : creerMonAappreils}
        </div>
      </div>
    </div>
  </div>
  <!-- Lien vers le JS de Bootstrap (facultatif) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
`;

  // Réponse HTTP avec un code de statut 200 et un type de contenu HTML
  reponse.writeHead(200, { "Content-Type": "text/html,charset=utf-8" });
  console.log(requette.url);

  /***
   * Pourquoi il y a /favicon.ico et pourquoi il est null en searchParams ?
   *
   * - /favicon.ico est une requête automatique effectuée par les navigateurs pour récupérer une icône associée à la page.
   * - favicon.ico n'a pas de query string, donc `searchParams.get("id")` renvoie `null`.
   */

  // Envoi de la réponse au client
  reponse.end(contenu);
});

// Génération de la liste des articles sous forme de liens
const genererListeArticle = ({ id, marque, nom, modele, prix }) =>
  `<li><a href= "?id=${id}">  ${marque} | ${nom} | ${modele}: ${prix} </a></li>`;

// Tableau des appareils disponibles
const appareils = [
  {
    id: 1,
    nom: "Guitare acoustique",
    marque: "Yamaha",
    modele: "FG800",
    prix: 200,
    categorie: "Cordes",
  },
  {
    id: 2,
    nom: "Piano numérique",
    marque: "Casio",
    modele: "PX-770",
    prix: 600,
    categorie: "Clavier",
  },
  {
    id: 3,
    nom: "Synthétiseur",
    marque: "Roland",
    modele: "Juno-DS76",
    prix: 1000,
    categorie: "Clavier",
  },
  {
    id: 4,
    nom: "Batterie électronique",
    marque: "Alesis",
    modele: "Nitro Mesh Kit",
    prix: 350,
    categorie: "Percussion",
  },
  {
    id: 5,
    nom: "Saxophone",
    marque: "Yamaha",
    modele: "YAS-280",
    prix: 1200,
    categorie: "Vent",
  },
  {
    id: 6,
    nom: "Violon",
    marque: "Stentor",
    modele: "Student II",
    prix: 150,
    categorie: "Cordes",
  },
  {
    id: 7,
    nom: "Flûte traversière",
    marque: "Gemeinhardt",
    modele: "2SP",
    prix: 300,
    categorie: "Vent",
  },
  {
    id: 8,
    nom: "Enceinte Bluetooth",
    marque: "JBL",
    modele: "Flip 5",
    prix: 100,
    categorie: "Accessoire",
  },
];

// Génération du contenu pour afficher tous les appareils sous forme de liste
const creerMonAappreils = `
<h2> Mon Appareils </h2>
<ul> ${appareils.map(genererListeArticle).join("\n")} </ul>
`;

// Fonction pour générer le contenu d'une carte pour un appareil spécifique
function obtenirContentu(id) {
  const article = appareils.find((a) => a.id == id); // Recherche de l'article par ID
  if (article) {
    // Retourne une carte Bootstrap avec les informations de l'article
    return `
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h3 class="text-center mb-0">${article.nom}</h3>
        </div>
        <div class="card-body">
          <h4 class="card-title text-center">${article.nom}</h4>
          <p class="card-text">
            <strong>ID :</strong> ${article.id}<br>
            <strong>Nom :</strong> ${article.nom}<br>
            <strong>Marque :</strong> ${article.marque}<br>
            <strong>Modèle :</strong> ${article.modele}<br>
            <strong>Prix :</strong> ${article.prix} €<br>
            <strong>Catégorie :</strong> ${article.categorie}
          </p>
          <div class="text-center mt-4">
            <a href="/" class="btn btn-secondary">Retour à la liste</a>
          </div>
        </div>
        <div class="card-footer text-center">
          <small class="text-muted">Informations mises à jour récemment</small>
        </div>
      </div>
    `;
  } else {
    // Si l'article n'est pas trouvé
    return `<p class="text-danger">Article non trouvé !</p>`;
  }
}

// Lancement du serveur sur le port 8000
serveur.listen(8000, () => {
  console.log(`Serveur est courant ${serveur.address().port}`);
});
```

### Suppression d'un élément via une requête HTTP

Lorsqu'il s'agit de supprimer un élément à l'aide d'une requête HTTP, nous pouvons utiliser des paramètres dans l'URL pour indiquer l'action et les données nécessaires. Par exemple, l'approche est similaire à celle utilisée en PHP où l'URL contient des informations sur l'action, telles que `?action=`.

Dans notre cas, nous utilisons une structure d'URL pour la suppression, comme :  
`/delete/?id=<identifiant>`.

Voici les étapes pour gérer cette suppression :

---

#### 1. **Analyser l'URL avec `request.url.split('/')`**

Cette méthode divise l'URL en segments pour identifier l'action demandée. Si l'URL contient le segment `"delete"`, cela indique qu'une suppression est demandée.

**Exemple** :  
Si l'URL est `/delete/7`, en utilisant `request.url.split('/')`, nous obtenons un tableau :

```javascript
["", "delete", "7"];
```

- Le premier élément est vide car l'URL commence par `/`.
- Le deuxième élément, `"delete"`, indique l'action.
- Le troisième élément, `"7"`, correspond à l'ID de l'élément à supprimer.

---

#### 2. **Identifier l'action avec `includes('delete')`**

Pour vérifier si l'URL demande une suppression, nous utilisons :

```javascript
if (segments.includes("delete")) {
  handleDelete(segments[2]); // Appeler la fonction pour supprimer l'élément avec l'ID donné
}
```

- `segments.includes('delete')` retourne `true` si `"delete"` est présent.
- `segments[2]` contient l'ID à supprimer.

---

#### 3. **Créer une fonction `handleDelete`**

Cette fonction prend l'ID comme argument, supprime l'élément correspondant de la base de données ou d'un tableau, et gère la réponse.

**Exemple de fonction** :

```javascript
function handleDelete(id) {
  appareils = appareils.filter((article) => article.id != id); // Supprimer l'élément par son ID
  console.log(`Article avec l'ID ${id} supprimé.`);
}
```

---

#### 4. **Rediriger après la suppression**

Après la suppression, nous devons rediriger l'utilisateur pour éviter qu'il ne reste sur l'URL `/delete/`. Cela peut être fait en renvoyant une réponse avec une redirection HTTP :

```javascript
reponse.writeHead(302, { Location: "/" }); // Rediriger vers la page d'accueil
reponse.end();
```

---

### Exemple complet de gestion de suppression

```javascript
const serveur = createServer((requette, reponse) => {
  const segments = requette.url.split("/"); // Diviser l'URL
  if (segments.includes("delete")) {
    handleDelete(segments[2]); // Supprimer l'article par ID
    reponse.writeHead(302, { Location: "/" }); // Redirection après suppression
    reponse.end();
  } else {
    // Autres actions
    reponse.writeHead(200, { "Content-Type": "text/html" });
    reponse.end(creerMonAappreils); // Afficher la liste des articles
  }
});
```

---

Voici un tableau récapitulatif des trois fonctions que vous avez mentionnées : `splice`, `findIndex` et `reponse.writeHead` (avec `redirect`).

| Fonction                | Description                                                                                                                                                                        | Syntaxe                                  | Exemple d'utilisation                                                                                                           |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| **`findIndex`**         | Recherche l'index du premier élément qui satisfait la condition spécifiée dans la fonction callback. Renvoie l'index de l'élément ou `-1` s'il n'est pas trouvé.                   | `array.findIndex(callback)`              | `let index = appareils.findIndex(a => a.id == id);`                                                                             |
| **`splice`**            | Modifie un tableau en ajoutant ou en supprimant des éléments. Le premier paramètre spécifie l'index de départ, et le deuxième paramètre spécifie le nombre d'éléments à supprimer. | `array.splice(start, deleteCount)`       | `appareils.splice(index, 1);` supprime un élément à l'index donné.                                                              |
| **`reponse.writeHead`** | Envoie les en-têtes HTTP de la réponse. Cela est souvent utilisé pour spécifier un code de statut, le type de contenu, etc.                                                        | `reponse.writeHead(statusCode, headers)` | `reponse.writeHead(302, { location: location, "Content-Type": "text/plain" });` pour rediriger.                                 |
| **`split`**             | Permet de découper une chaîne de caractères en un tableau en fonction d'un séparateur.                                                                                             | `string.split(separator)`                | `const partie = requette.url.split("/");` sépare l'URL en un tableau où chaque élément est une partie de l'URL séparée par `/`. |
| **`includes`**          | Vérifie si un tableau contient un élément spécifique. Renvoie `true` si l'élément est présent, sinon `false`.                                                                      | `array.includes(element)`                | `if (partie.includes("delete")) { ... }` vérifie si le tableau `partie` contient l'élément `"delete"`.                          |

```js
import { createServer } from "http"; // Importation du module "http" pour créer un serveur

// Création d'un serveur HTTP
const serveur = createServer((requette, reponse) => {
  // Analyse de l'URL de la requête
  const url = new URL(requette.url, "http://localhost");

  // Extraction du paramètre "id" de la chaîne de requête (query string)
  console.log(url.searchParams.get("id"));
  const id = url.searchParams.get("id");

  const partie = requette.url.split("/");
  if (partie.includes("delete")) {
    supprimer(partie[2]);
    redirect(reponse, "/");
  } else {
    // Contenu HTML qui sera renvoyé comme réponse
    const contenu = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple de Paragraphe Stylisé</title>
  <!-- Lien vers le CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="p-4 bg-light border rounded">
          <h1 class="text-center mb-4">Bienvenue</h1>
          <p class="lead text-justify">
            Bonjour et bienvenue sur notre site web. Ce paragraphe est un exemple de contenu en français stylisé avec 
            <strong>Bootstrap</strong>. Bootstrap facilite la mise en page et le style des éléments HTML, 
            rendant les interfaces modernes et attrayantes. Profitez de la flexibilité et des outils qu'il offre !
          </p>

          <!-- Affichage dynamique du contenu en fonction de l'ID dans la query string -->
          ${id ? obtenirContentu(id) : creerMonAappreils}
        </div>
      </div>
    </div>
  </div>
  <!-- Lien vers le JS de Bootstrap (facultatif) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
`;

    // Réponse HTTP avec un code de statut 200 et un type de contenu HTML
    reponse.writeHead(200, { "Content-Type": "text/html,charset=utf-8" });

    reponse.end(contenu);
  }
  console.log(requette.url);
});

// Génération de la liste des articles sous forme de liens
const genererListeArticle = ({ id, marque, nom, modele, prix }) =>
  `<li><a href= "?id=${id}">  ${marque} | ${nom} | ${modele}: ${prix} </a></li>`;

// Tableau des appareils disponibles
const appareils = [
  {
    id: 1,
    nom: "Guitare acoustique",
    marque: "Yamaha",
    modele: "FG800",
    prix: 200,
    categorie: "Cordes",
  },
  {
    id: 2,
    nom: "Piano numérique",
    marque: "Casio",
    modele: "PX-770",
    prix: 600,
    categorie: "Clavier",
  },
  {
    id: 3,
    nom: "Synthétiseur",
    marque: "Roland",
    modele: "Juno-DS76",
    prix: 1000,
    categorie: "Clavier",
  },
  {
    id: 4,
    nom: "Batterie électronique",
    marque: "Alesis",
    modele: "Nitro Mesh Kit",
    prix: 350,
    categorie: "Percussion",
  },
  {
    id: 5,
    nom: "Saxophone",
    marque: "Yamaha",
    modele: "YAS-280",
    prix: 1200,
    categorie: "Vent",
  },
  {
    id: 6,
    nom: "Violon",
    marque: "Stentor",
    modele: "Student II",
    prix: 150,
    categorie: "Cordes",
  },
  {
    id: 7,
    nom: "Flûte traversière",
    marque: "Gemeinhardt",
    modele: "2SP",
    prix: 300,
    categorie: "Vent",
  },
  {
    id: 8,
    nom: "Enceinte Bluetooth",
    marque: "JBL",
    modele: "Flip 5",
    prix: 100,
    categorie: "Accessoire",
  },
];

// Génération du contenu pour afficher tous les appareils sous forme de liste
const creerMonAappreils = `
<h2> Mon Appareils </h2>
<ul> ${appareils.map(genererListeArticle).join("\n")} </ul>
`;

// Fonction pour générer le contenu d'une carte pour un appareil spécifique
function obtenirContentu(id) {
  const article = appareils.find((a) => a.id == id); // Recherche de l'article par ID
  if (article) {
    // Retourne une carte Bootstrap avec les informations de l'article
    return `
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h3 class="text-center mb-0">${article.nom}</h3>
        </div>
        <div class="card-body">
          <h4 class="card-title text-center">${article.nom}</h4>
          <p class="card-text">
            <strong>ID :</strong> ${article.id}<br>
            <strong>Nom :</strong> ${article.nom}<br>
            <strong>Marque :</strong> ${article.marque}<br>
            <strong>Modèle :</strong> ${article.modele}<br>
            <strong>Prix :</strong> ${article.prix} €<br>
            <strong>Catégorie :</strong> ${article.categorie}
          </p>
          <div class="text-center mt-4">
            <a href="/delete/${id}" class="btn btn-danger">Supprimer</a>
          </div>
        </div>
        <div class="card-footer text-center">
          <small class="text-muted">Informations mises à jour récemment</small>
        </div>
      </div>
    `;
  } else {
    // Si l'article n'est pas trouvé
    return `<p class="text-danger">Article non trouvé !</p>`;
  }
}

const supprimer = (id) => {
  let position = appareils.findIndex((a) => a.id == id);
  appareils.splice(position, 1);
};

function redirect(reponse, location) {
  reponse.writeHead(302, { location: location, "Content-Type": "text/plain" });
  reponse.end(`redigrer à ${location}`);
}

// Lancement du serveur sur le port 8000
serveur.listen(8000, () => {
  console.log(`Serveur est courant ${serveur.address().port}`);
});
```

### Explication du Code

Dans ce code, l'objectif est de déterminer quel contenu afficher en fonction de l'URL de la requête et de certains paramètres, comme l'action ("add" ou un identifiant d'article).

Voici comment chaque partie du code fonctionne :

1. **Initialisation de `contenu` :**

   - On commence par définir une variable `contenu` vide qui sera utilisée pour stocker le contenu à afficher dans la réponse HTTP.

2. **Si l'URL contient `add` :**
   - Si l'URL contient le mot `"add"`, cela signifie que l'utilisateur souhaite ajouter un nouvel élément (par exemple, un nouvel appareil). Dans ce cas, on affiche un formulaire de saisie en appelant la fonction `getForm()`.
3. **Si l'URL contient un identifiant (`id`) :**

   - Si un identifiant d'article (`id`) est présent dans l'URL, on cherche à afficher les détails de cet article. On appelle alors la fonction `obtenirContenu(xxx)` pour récupérer et afficher les informations relatives à cet article particulier.

4. **Si aucune des conditions précédentes n'est remplie :**
   - Si l'URL ne contient ni `"add"` ni un identifiant, cela signifie que l'on doit afficher la liste de tous les appareils disponibles. On appelle alors la fonction `creerMonAppareils`, qui génère et affiche la liste des appareils.

### Exemple de Code

Voici un exemple de code basé sur cette logique :

```javascript
let contenu = "";

if (requette.url.includes("add")) {
  contenu = getForm(); // Afficher le formulaire d'ajout
} else if (id) {
  contenu = obtenirContenu(id); // Afficher le contenu d'un article spécifique
} else {
  contenu = creerMonAppareils(); // Afficher la liste des appareils
}

// Répondre avec le contenu généré
reponse.writeHead(200, { "Content-Type": "text/html" });
reponse.end(contenu);
```

- **`getForm()`** : Fonction qui génère un formulaire pour ajouter un nouvel article (par exemple, un appareil musical).
- **`obtenirContenu(id)`** : Fonction qui génère le contenu pour afficher les détails d'un article en fonction de son identifiant `id`.
- **`creerMonAppareils()`** : Fonction qui génère une liste de tous les appareils disponibles.

### Section README

Voici un exemple de section README pour expliquer la structure et le fonctionnement de ce code :

---

## Gestion des Actions sur les Appareils

Ce serveur HTTP permet d'afficher et de gérer des appareils en fonction de l'URL de la requête. Le comportement du serveur dépend de l'URL, qui peut inclure des actions comme l'ajout d'un nouvel appareil ou l'affichage des détails d'un appareil spécifique.

### Structure du Code

Lors de chaque requête, le serveur décide quel contenu afficher en fonction de l'URL de la requête :

1. **Ajouter un appareil :**

   - Si l'URL contient le mot-clé `add`, le serveur affiche un formulaire pour ajouter un nouvel appareil.
   - Exemple : `/add` affiche le formulaire d'ajout.

   ```javascript
   if (requette.url.includes("add")) {
     contenu = obtenirForm();
   }
   ```

2. **Afficher les détails d'un appareil spécifique :**

   - Si l'URL contient un identifiant (`id`), le serveur récupère et affiche les détails de l'appareil correspondant à cet identifiant.
   - Exemple : `/$id=1` affiche les détails de l'appareil avec l'ID 1.

   ```javascript
   else if (id) {
     contenu = obtenirContenu(id);
   }
   ```

3. **Afficher la liste des appareils :**

   - Si l'URL ne contient ni l'action `add` ni un identifiant `id`, le serveur affiche la liste de tous les appareils disponibles.

   ```javascript
   else {
     contenu = creerMonAppareils();
   }
   ```

### Exemple d'URL

- `/add` : Affiche le formulaire pour ajouter un appareil.
- `/?id=1` : Affiche les détails de l'appareil avec l'ID 1.
- `/` : Affiche la liste complète des appareils disponibles.

---

Lorsque vous travaillez avec des requêtes HTTP, il est important de comprendre que chaque type de requête (comme GET, POST, PUT, DELETE) a un but spécifique. Dans le cas de votre application, vous souhaitez gérer différentes actions en fonction du type de requête HTTP que le serveur reçoit.

**POST** est utilisé principalement pour envoyer des données au serveur. Lorsque l'utilisateur soumet un formulaire, par exemple, les informations qu'il a saisies (comme le nom, la marque, le modèle, etc.) sont envoyées sous forme de données à votre serveur via une requête POST. C'est ainsi que vous pouvez ajouter un nouvel appareil à votre liste.

Voici ce que vous devez faire :

1. **Vérifier le type de requête** : Quand une requête arrive, vous devez d'abord vérifier si c'est une requête **POST** ou une autre requête. Cela vous permet de savoir si l'utilisateur soumet un formulaire avec des informations.
   - Si la requête est de type **POST**, cela signifie que l'utilisateur a soumis des données. Vous pouvez alors récupérer ces données et les traiter (comme ajouter un nouvel appareil à votre liste).
   - Si la requête est d'un autre type, comme **GET**, vous pouvez simplement afficher des informations ou répondre à une demande sans modifier les données.
2. **Gestion des différentes requêtes** : En fonction du type de requête, vous pouvez diviser votre code pour répondre correctement. Par exemple :
   - **POST** : Recevoir les données du formulaire, les traiter, et peut-être rediriger l'utilisateur vers une autre page.
   - **GET** : Afficher la liste des appareils ou les détails d'un appareil spécifique.

**Exemple concret dans votre code** :

```javascript
// Vérification du type de requête
if (requette.method === "POST") {
  // Traitement de la requête POST (ajout de l'appareil)
  let corps = "";
  requette.on("readable", () => {
    const data = requette.read();
    if (data !== null) {
      corps += data;
    }
  });
  requette.on("end", () => {
    const article = new URLSearchParams(corps); // Analyse du corps de la requête
    const nouvelAppareil = {
      id: appareils.length + 1,
      nom: article.get("nom"),
      marque: article.get("marque"),
      modele: article.get("modele"),
      prix: parseFloat(article.get("prix")),
      categorie: article.get("categorie"),
    };
    // Ajouter le nouvel appareil
    ajouterAppareils(nouvelAppareil);
    // Redirection après l'ajout
    redirect(reponse, "/");
  });
}
```

Dans cet exemple, nous vérifions si la requête est une requête **POST** pour traiter les données soumises par le formulaire. Si c'est le cas, nous extrayons les informations du formulaire, les traitons et ajoutons l'appareil à la liste.

En résumé, la gestion des différents types de requêtes HTTP vous permet de structurer votre code de manière à répondre à des actions spécifiques. Par exemple :

- **GET** pour afficher des informations.
- **POST** pour envoyer des données au serveur et les traiter.
- **DELETE** pour supprimer des ressources, etc.

```js
import { createServer } from "http"; // Importation du module "http" pour créer un serveur

// Création d'un serveur HTTP
const serveur = createServer((requette, reponse) => {
  // Analyse de l'URL de la requête
  const url = new URL(requette.url, "http://localhost");

  // Extraction du paramètre "id" de la chaîne de requête (query string)
  let contentu = ``;
  const partie = requette.url.split("/");

  // Vérification de la méthode HTTP (POST) pour la gestion des formulaires
  if (requette.method === "POST") {
    let corps = "";

    requette.on("readable", () => {
      const data = requette.read();
      if (data !== null) {
        corps += data;
      }
    });
    requette.on("end", () => {
      console.log(corps); // Affichage du corps de la requête
      // Traitement des données du formulaire (ajouter l'appareil)
      // Vous devez ici traiter `corps` pour ajouter l'appareil à `appareils`

      // Corps de la requête entièrement reçu
      // Utilisation de JSON.parse ou un autre moyen pour analyser le corps de la requête
      const article = new URLSearchParams(corps); // Analyser les données envoyées par le formulaire (URL encoded)

      const nouvelAppareil = {
        id: appareils.length + 1, // Assigner un ID unique (simple incrémentation)
        nom: article.get("nom"), // Récupérer le nom de l'appareil
        marque: article.get("marque"), // Récupérer la marque
        modele: article.get("modele"), // Récupérer le modèle
        prix: parseFloat(article.get("prix")), // Récupérer le prix (et le convertir en nombre)
        categorie: article.get("categorie"), // Récupérer la catégorie
      };
      console.log(nouvelAppareil);

      // Ajouter le nouvel appareil à la liste
      ajouterAppareils(nouvelAppareil);
      console.log(appareils);

      redirect(reponse, "/");
    });
  }

  // Vérification de l'URL pour les opérations "delete"
  if (partie.includes("delete")) {
    supprimer(partie[2]);
    redirect(reponse, "/");
  } else {
    console.log(url.searchParams.get("id"));
    const id = url.searchParams.get("id");

    if (partie.includes("ajouter")) {
      contentu = obtenirForme();
    } else {
      // Contenu HTML qui sera renvoyé comme réponse
      contentu = `<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple de Paragraphe Stylisé</title>
  <!-- Lien vers le CSS de Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-8 offset-md-2">
        <div class="p-4 bg-light border rounded">
          <h1 class="text-center mb-4">Bienvenue</h1>
          <p class="lead text-justify">
            Bonjour et bienvenue sur notre site web. Ce paragraphe est un exemple de contenu en français stylisé avec 
            <strong>Bootstrap</strong>. Bootstrap facilite la mise en page et le style des éléments HTML, 
            rendant les interfaces modernes et attrayantes. Profitez de la flexibilité et des outils qu'il offre !
          </p>

          <!-- Affichage dynamique du contenu en fonction de l'ID dans la query string -->
          ${id ? obtenirContentu(id) : creerMonAappreils}
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-5">
    <button class="btn btn-secondary"> 
      <a href="/ajouter">Ajouter</a>
    </button>
  </div>
  <!-- Lien vers le JS de Bootstrap (facultatif) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
`;
    }

    // Réponse HTTP avec un code de statut 200 et un type de contenu HTML
    reponse.writeHead(200, { "Content-Type": "text/html;charset=utf-8" });
  }
  reponse.end(contentu);
  console.log(requette.url);
});

// Génération de la liste des articles sous forme de liens
const genererListeArticle = ({ id, marque, nom, modele, prix }) =>
  `<li><a href="?id=${id}">${marque} | ${nom} | ${modele}: ${prix} €</a></li>`;

// Tableau des appareils disponibles
const appareils = [
  {
    id: 1,
    nom: "Guitare acoustique",
    marque: "Yamaha",
    modele: "FG800",
    prix: 200,
    categorie: "Cordes",
  },
  {
    id: 2,
    nom: "Piano numérique",
    marque: "Casio",
    modele: "PX-770",
    prix: 600,
    categorie: "Clavier",
  },
  {
    id: 3,
    nom: "Synthétiseur",
    marque: "Roland",
    modele: "Juno-DS76",
    prix: 1000,
    categorie: "Clavier",
  },
  {
    id: 4,
    nom: "Batterie électronique",
    marque: "Alesis",
    modele: "Nitro Mesh Kit",
    prix: 350,
    categorie: "Percussion",
  },
  {
    id: 5,
    nom: "Saxophone",
    marque: "Yamaha",
    modele: "YAS-280",
    prix: 1200,
    categorie: "Vent",
  },
  {
    id: 6,
    nom: "Violon",
    marque: "Stentor",
    modele: "Student II",
    prix: 150,
    categorie: "Cordes",
  },
  {
    id: 7,
    nom: "Flûte traversière",
    marque: "Gemeinhardt",
    modele: "2SP",
    prix: 300,
    categorie: "Vent",
  },
  {
    id: 8,
    nom: "Enceinte Bluetooth",
    marque: "JBL",
    modele: "Flip 5",
    prix: 100,
    categorie: "Accessoire",
  },
];

const ajouterAppareils = (obj) => {
  appareils.push(obj); // Ajout d'un appareil dans le tableau
};

// Génération du contenu pour afficher tous les appareils sous forme de liste
const creerMonAappreils = `
<h2>Mes Appareils</h2>
<ul>${appareils.map(genererListeArticle).join("\n")}</ul>
`;

// Fonction pour générer le contenu d'une carte pour un appareil spécifique
function obtenirContentu(id) {
  let article = appareils.find((a) => a.id == id); // Recherche de l'article par ID
  if (article) {
    // Retourne une carte Bootstrap avec les informations de l'article
    return `
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h3 class="text-center mb-0">${article.nom}</h3>
        </div>
        <div class="card-body">
          <h4 class="card-title text-center">${article.nom}</h4>
          <p class="card-text">
            <strong>ID :</strong> ${article.id}<br>
            <strong>Nom :</strong> ${article.nom}<br>
            <strong>Marque :</strong> ${article.marque}<br>
            <strong>Modèle :</strong> ${article.modele}<br>
            <strong>Prix :</strong> ${article.prix} €<br>
            <strong>Catégorie :</strong> ${article.categorie}
          </p>
          <div class="text-center mt-4">
            <a href="/delete/${id}" class="btn btn-danger">Supprimer</a>
          </div>
        </div>
        <div class="card-footer text-center">
          <small class="text-muted">Informations mises à jour récemment</small>
        </div>
      </div>
    `;
  } else {
    // Si l'article n'est pas trouvé
    return `<p class="text-danger">Article non trouvé !</p>`;
  }
}

// Fonction pour supprimer un appareil du tableau
const supprimer = (id) => {
  let position = appareils.findIndex((a) => a.id == id);
  if (position !== -1) {
    appareils.splice(position, 1); // Suppression de l'article par index
  }
};

// Fonction pour rediriger l'utilisateur vers une autre page
function redirect(reponse, location) {
  reponse.writeHead(302, { location: location, "Content-Type": "text/plain" });
  reponse.end(`Redirection vers ${location}`);
}

// Fonction pour obtenir le formulaire d'ajout d'appareil
function obtenirForme() {
  return `
    <!DOCTYPE html>
    <html lang="fr">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ajouter un appareil</title>
      <!-- Lien vers le CSS de Bootstrap -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body>
      <div class="container mt-5">
        <div class="row">
          <div class="col-md-8 offset-md-2">
            <div class="p-4 bg-light border rounded">
              <h1 class="text-center mb-4">Ajouter un appareil</h1>
              <form action="/add" method="POST">
                <div class="mb-3">
                  <label for="nom" class="form-label">Nom de l'appareil</label>
                  <input type="text" class="form-control" id="nom" name="nom" required>
                </div>
                <div class="mb-3">
                  <label for="marque" class="form-label">Marque</label>
                  <input type="text" class="form-control" id="marque" name="marque" required>
                </div>
                <div class="mb-3">
                  <label for="modele" class="form-label">Modèle</label>
                  <input type="text" class="form-control" id="modele" name="modele" required>
                </div>
                <div class="mb-3">
                  <label for="prix" class="form-label">Prix</label>
                  <input type="number" class="form-control" id="prix" name="prix" required>
                </div>
                <div class="mb-3">
                  <label for="categorie" class="form-label">Catégorie</label>
                  <select class="form-control" id="categorie" name="categorie" required>
                    <option value="Cordes">Cordes</option>
                    <option value="Clavier">Clavier</option>
                    <option value="Percussion">Percussion</option>
                    <option value="Vent">Vent</option>
                    <option value="Accessoire">Accessoire</option>
                  </select>
                </div>
                <button type="submit"  class="btn btn-primary">Ajouter l'appareil</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Lien vers le JS de Bootstrap -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    </body>
    </html>
  `;
}

// Lancement du serveur sur le port 8000
serveur.listen(8000, () => {
  console.log(`Serveur est courant ${serveur.address().port}`);
});
```
